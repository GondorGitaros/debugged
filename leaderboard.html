<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debugged - Leaderboard</title>
    <style>
        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #ffffff;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 3em;
            color: #00ffcc;
            text-shadow: 0 0 20px #00ffcc;
            margin: 0;
        }
        
        .subtitle {
            font-size: 1.2em;
            color: #ffffff;
            margin: 10px 0;
        }
        
        .back-button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background: #ff6666;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .leaderboard-table th {
            background: rgba(0, 255, 204, 0.2);
            color: #00ffcc;
            padding: 15px;
            text-align: left;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .leaderboard-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .leaderboard-table tr:hover {
            background: rgba(0, 255, 204, 0.1);
        }
        
        .rank {
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .rank.top-3 {
            color: #ffd700;
        }
        
        .username {
            font-weight: bold;
            color: #ffffff;
        }
        
        .level {
            color: #00ff88;
            font-weight: bold;
        }
        
        .time {
            color: #88ccff;
        }
        
        .completed-at {
            color: #cccccc;
            font-size: 0.9em;
        }
        
        .loading {
            text-align: center;
            font-size: 1.5em;
            color: #00ffcc;
            margin: 50px 0;
        }
        
        .error {
            text-align: center;
            color: #ff4444;
            font-size: 1.2em;
            margin: 50px 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(0, 255, 204, 0.1);
            border: 1px solid #00ffcc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #00ffcc;
            display: block;
        }
        
        .stat-label {
            color: #ffffff;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .leaderboard-table {
                font-size: 0.9em;
            }
            
            .leaderboard-table th,
            .leaderboard-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üèÜ LEADERBOARD üèÜ</h1>
            <p class="subtitle">Fastest Game Completers in Debugged</p>
            <button class="back-button" onclick="goBack()">‚Üê Back to Game</button>
        </div>
        
        <div id="stats" class="stats" style="display: none;">
            <div class="stat-card">
                <span id="total-players" class="stat-number">0</span>
                <div class="stat-label">Total Players</div>
            </div>
        </div>
        
        <div id="loading" class="loading">
            Loading leaderboard...
        </div>
        
        <div id="error" class="error" style="display: none;">
            Failed to load leaderboard. Please try again later.
        </div>
        
        <table id="leaderboard-table" class="leaderboard-table" style="display: none;">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th>Time</th>
                    <th>Date Achieved</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
            </tbody>
        </table>
    </div>

    <script>
        function goBack() {
            window.location.href = '/';
        }
        
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}h ${minutes}m ${secs}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        function getLevelStatus(level) {
            if (level >= 10) return "üëë COMPLETED";
            return `Level ${level}`;
        }
        
        async function loadLeaderboard() {
            try {
                const response = await fetch('leaderboard.php');
                const data = await response.json();
                
                if (data.success) {
                    displayLeaderboard(data.leaderboard);
                    calculateStats(data.leaderboard);
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                showError();
            }
        }
        
        function displayLeaderboard(leaderboard) {
            const tbody = document.getElementById('leaderboard-body');
            const table = document.getElementById('leaderboard-table');
            const loading = document.getElementById('loading');
            
            loading.style.display = 'none';
            table.style.display = 'table';
            
            tbody.innerHTML = '';
            
            leaderboard.forEach(player => {
                const row = document.createElement('tr');
                
                const rankClass = player.rank <= 3 ? 'rank top-3' : 'rank';
                const rankEmoji = player.rank === 1 ? 'ü•á' : player.rank === 2 ? 'ü•à' : player.rank === 3 ? 'ü•â' : '';
                
                row.innerHTML = `
                    <td class="${rankClass}">${rankEmoji} #${player.rank}</td>
                    <td class="username">${escapeHtml(player.username)}</td>
                    <td class="time">${formatTime(player.time)}</td>
                    <td class="completed-at">${formatDate(player.completed_at)}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function calculateStats(leaderboard) {
            const stats = document.getElementById('stats');
            stats.style.display = 'grid';
            
            const totalPlayers = leaderboard.length;
            
            document.getElementById('total-players').textContent = totalPlayers;
        }
        
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Load leaderboard when page loads
        loadLeaderboard();
        
        // Auto-refresh every 30 seconds
        setInterval(loadLeaderboard, 30000);
    </script>
</body>
</html>
